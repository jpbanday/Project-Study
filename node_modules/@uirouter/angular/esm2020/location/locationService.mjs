import { BaseLocationServices, parseUrl } from '@uirouter/core';
/** A `LocationServices` that delegates to the Angular LocationStrategy */
export class Ng2LocationServices extends BaseLocationServices {
    constructor(router, _locationStrategy, isBrowser) {
        super(router, isBrowser);
        this._locationStrategy = _locationStrategy;
        this._locationStrategy.onPopState((evt) => {
            if (evt.type !== 'hashchange') {
                this._listener(evt);
            }
        });
    }
    _get() {
        return this._locationStrategy.path(true).replace(this._locationStrategy.getBaseHref().replace(/\/$/, ''), '');
    }
    _set(state, title, url, replace) {
        const { path, search, hash } = parseUrl(url);
        const hashWithPrefix = hash ? '#' + hash : '';
        let urlPath = path;
        let urlParams = search;
        if (search) {
            urlParams += hashWithPrefix;
        }
        else {
            urlPath += hashWithPrefix;
        }
        if (replace) {
            this._locationStrategy.replaceState(state, title, urlPath, urlParams);
        }
        else {
            this._locationStrategy.pushState(state, title, urlPath, urlParams);
        }
    }
    dispose(router) {
        super.dispose(router);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYXRpb25TZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xvY2F0aW9uL2xvY2F0aW9uU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsUUFBUSxFQUFZLE1BQU0sZ0JBQWdCLENBQUM7QUFHMUUsMEVBQTBFO0FBQzFFLE1BQU0sT0FBTyxtQkFBb0IsU0FBUSxvQkFBb0I7SUFDM0QsWUFBWSxNQUFnQixFQUFVLGlCQUFtQyxFQUFFLFNBQWtCO1FBQzNGLEtBQUssQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFEVyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQWtCO1FBR3ZFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUN4QyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssWUFBWSxFQUFFO2dCQUM3QixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3JCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDaEgsQ0FBQztJQUVELElBQUksQ0FBQyxLQUFVLEVBQUUsS0FBYSxFQUFFLEdBQVcsRUFBRSxPQUFnQjtRQUMzRCxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFN0MsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDOUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQztRQUV2QixJQUFJLE1BQU0sRUFBRTtZQUNWLFNBQVMsSUFBSSxjQUFjLENBQUM7U0FDN0I7YUFBTTtZQUNMLE9BQU8sSUFBSSxjQUFjLENBQUM7U0FDM0I7UUFFRCxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDdkU7YUFBTTtZQUNMLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDcEU7SUFDSCxDQUFDO0lBRUQsT0FBTyxDQUFDLE1BQWdCO1FBQ3RCLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZUxvY2F0aW9uU2VydmljZXMsIHBhcnNlVXJsLCBVSVJvdXRlciB9IGZyb20gJ0B1aXJvdXRlci9jb3JlJztcbmltcG9ydCB7IExvY2F0aW9uU3RyYXRlZ3kgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG4vKiogQSBgTG9jYXRpb25TZXJ2aWNlc2AgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIEFuZ3VsYXIgTG9jYXRpb25TdHJhdGVneSAqL1xuZXhwb3J0IGNsYXNzIE5nMkxvY2F0aW9uU2VydmljZXMgZXh0ZW5kcyBCYXNlTG9jYXRpb25TZXJ2aWNlcyB7XG4gIGNvbnN0cnVjdG9yKHJvdXRlcjogVUlSb3V0ZXIsIHByaXZhdGUgX2xvY2F0aW9uU3RyYXRlZ3k6IExvY2F0aW9uU3RyYXRlZ3ksIGlzQnJvd3NlcjogYm9vbGVhbikge1xuICAgIHN1cGVyKHJvdXRlciwgaXNCcm93c2VyKTtcblxuICAgIHRoaXMuX2xvY2F0aW9uU3RyYXRlZ3kub25Qb3BTdGF0ZSgoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnR5cGUgIT09ICdoYXNoY2hhbmdlJykge1xuICAgICAgICB0aGlzLl9saXN0ZW5lcihldnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgX2dldCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbG9jYXRpb25TdHJhdGVneS5wYXRoKHRydWUpLnJlcGxhY2UodGhpcy5fbG9jYXRpb25TdHJhdGVneS5nZXRCYXNlSHJlZigpLnJlcGxhY2UoL1xcLyQvLCAnJyksICcnKTtcbiAgfVxuXG4gIF9zZXQoc3RhdGU6IGFueSwgdGl0bGU6IHN0cmluZywgdXJsOiBzdHJpbmcsIHJlcGxhY2U6IGJvb2xlYW4pOiBhbnkge1xuICAgIGNvbnN0IHsgcGF0aCwgc2VhcmNoLCBoYXNoIH0gPSBwYXJzZVVybCh1cmwpO1xuXG4gICAgY29uc3QgaGFzaFdpdGhQcmVmaXggPSBoYXNoID8gJyMnICsgaGFzaCA6ICcnO1xuICAgIGxldCB1cmxQYXRoID0gcGF0aDtcbiAgICBsZXQgdXJsUGFyYW1zID0gc2VhcmNoO1xuXG4gICAgaWYgKHNlYXJjaCkge1xuICAgICAgdXJsUGFyYW1zICs9IGhhc2hXaXRoUHJlZml4O1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmxQYXRoICs9IGhhc2hXaXRoUHJlZml4O1xuICAgIH1cblxuICAgIGlmIChyZXBsYWNlKSB7XG4gICAgICB0aGlzLl9sb2NhdGlvblN0cmF0ZWd5LnJlcGxhY2VTdGF0ZShzdGF0ZSwgdGl0bGUsIHVybFBhdGgsIHVybFBhcmFtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2xvY2F0aW9uU3RyYXRlZ3kucHVzaFN0YXRlKHN0YXRlLCB0aXRsZSwgdXJsUGF0aCwgdXJsUGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICBkaXNwb3NlKHJvdXRlcjogVUlSb3V0ZXIpIHtcbiAgICBzdXBlci5kaXNwb3NlKHJvdXRlcik7XG4gIH1cbn1cbiJdfQ==