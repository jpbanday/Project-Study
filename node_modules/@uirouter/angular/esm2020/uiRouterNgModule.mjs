import { UIROUTER_MODULE_TOKEN, UIROUTER_ROOT_MODULE } from './injectionTokens';
import { NgModule, ANALYZE_FOR_ENTRY_COMPONENTS, APP_INITIALIZER, } from '@angular/core';
import { CommonModule, LocationStrategy, HashLocationStrategy, PathLocationStrategy } from '@angular/common';
import { _UIROUTER_DIRECTIVES } from './directives/directives';
import { UIView } from './directives/uiView';
import { TransitionService } from '@uirouter/core';
import { _UIROUTER_INSTANCE_PROVIDERS, _UIROUTER_SERVICE_PROVIDERS } from './providers';
import * as i0 from "@angular/core";
import * as i1 from "./directives/uiSref";
import * as i2 from "./directives/uiView";
import * as i3 from "./directives/uiSrefActive";
import * as i4 from "./directives/uiSrefStatus";
// Delay angular bootstrap until first transition is successful, for SSR.
// See https://github.com/ui-router/angular/pull/127
export function onTransitionReady(transitionService, root) {
    const mod = root[0];
    if (!mod || !mod.deferInitialRender) {
        return () => Promise.resolve();
    }
    return () => new Promise((resolve) => {
        const hook = (trans) => {
            trans.promise.then(resolve, resolve);
        };
        transitionService.onStart({}, hook, { invokeLimit: 1 });
    });
}
export function makeRootProviders(module) {
    return [
        { provide: UIROUTER_ROOT_MODULE, useValue: module, multi: true },
        { provide: UIROUTER_MODULE_TOKEN, useValue: module, multi: true },
        { provide: ANALYZE_FOR_ENTRY_COMPONENTS, useValue: module.states || [], multi: true },
        {
            provide: APP_INITIALIZER,
            useFactory: onTransitionReady,
            deps: [TransitionService, UIROUTER_ROOT_MODULE],
            multi: true,
        },
    ];
}
export function makeChildProviders(module) {
    return [
        { provide: UIROUTER_MODULE_TOKEN, useValue: module, multi: true },
        { provide: ANALYZE_FOR_ENTRY_COMPONENTS, useValue: module.states || [], multi: true },
    ];
}
export function locationStrategy(useHash) {
    return { provide: LocationStrategy, useClass: useHash ? HashLocationStrategy : PathLocationStrategy };
}
/**
 * Creates UI-Router Modules
 *
 * This class has two static factory methods which create UIRouter Modules.
 * A UI-Router Module is an [Angular NgModule](https://angular.io/docs/ts/latest/guide/ngmodule.html)
 * with support for UI-Router.
 *
 * ### UIRouter Directives
 *
 * When a UI-Router Module is imported into a `NgModule`, that module's components
 * can use the UIRouter Directives such as [[UIView]], [[UISref]], [[UISrefActive]].
 *
 * ### State Definitions
 *
 * State definitions found in the `states:` property are provided to the Dependency Injector.
 * This enables UI-Router to automatically register the states with the [[StateRegistry]] at bootstrap (and during lazy load).
 *
 * ### Entry Components
 *
 * Any routed components are added as `entryComponents:` so they will get compiled.
 */
export class UIRouterModule {
    /**
     * Creates a UI-Router Module for the root (bootstrapped) application module to import
     *
     * This factory function creates an [Angular NgModule](https://angular.io/docs/ts/latest/guide/ngmodule.html)
     * with UI-Router support.
     *
     * The `forRoot` module should be added to the `imports:` of the `NgModule` being bootstrapped.
     * An application should only create and import a single `NgModule` using `forRoot()`.
     * All other modules should be created using [[UIRouterModule.forChild]].
     *
     * Unlike `forChild`, an `NgModule` returned by this factory provides the [[UIRouter]] singleton object.
     * This factory also accepts root-level router configuration.
     * These are the only differences between `forRoot` and `forChild`.
     *
     * Example:
     * ```js
     * let routerConfig = {
     *   otherwise: '/home',
     *   states: [homeState, aboutState]
     * };
     *
     * @ NgModule({
     *   imports: [
     *     BrowserModule,
     *     UIRouterModule.forRoot(routerConfig),
     *     FeatureModule1
     *   ]
     * })
     * class MyRootAppModule {}
     *
     * browserPlatformDynamic.bootstrapModule(MyRootAppModule);
     * ```
     *
     * @param config declarative UI-Router configuration
     * @returns an `NgModule` which provides the [[UIRouter]] singleton instance
     */
    static forRoot(config = {}) {
        return {
            ngModule: UIRouterModule,
            providers: [
                _UIROUTER_INSTANCE_PROVIDERS,
                _UIROUTER_SERVICE_PROVIDERS,
                locationStrategy(config.useHash),
                ...makeRootProviders(config),
            ],
        };
    }
    /**
     * Creates an `NgModule` for a UIRouter module
     *
     * This function creates an [Angular NgModule](https://angular.io/docs/ts/latest/guide/ngmodule.html)
     * with UI-Router support.
     *
     * #### Example:
     * ```js
     * var homeState = { name: 'home', url: '/home', component: Home };
     * var aboutState = { name: 'about', url: '/about', component: About };
     *
     * @ NgModule({
     *   imports: [
     *     UIRouterModule.forChild({ states: [ homeState, aboutState ] }),
     *     SharedModule,
     *   ],
     *   declarations: [ Home, About ],
     * })
     * export class AppModule {};
     * ```
     *
     * @param module UI-Router module options
     * @returns an `NgModule`
     */
    static forChild(module = {}) {
        return {
            ngModule: UIRouterModule,
            providers: makeChildProviders(module),
        };
    }
}
UIRouterModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: UIRouterModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
UIRouterModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: UIRouterModule, declarations: [i1.UISref, i1.AnchorUISref, i2.UIView, i3.UISrefActive, i4.UISrefStatus], imports: [CommonModule], exports: [i1.UISref, i1.AnchorUISref, i2.UIView, i3.UISrefActive, i4.UISrefStatus] });
UIRouterModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: UIRouterModule, imports: [[CommonModule]] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: UIRouterModule, decorators: [{
            type: NgModule,
            args: [{
                    imports: [CommonModule],
                    declarations: [_UIROUTER_DIRECTIVES],
                    exports: [_UIROUTER_DIRECTIVES],
                    entryComponents: [UIView],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWlSb3V0ZXJOZ01vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91aVJvdXRlck5nTW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWhGLE9BQU8sRUFDTCxRQUFRLEVBRVIsNEJBQTRCLEVBRzVCLGVBQWUsR0FDaEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxvQkFBb0IsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdHLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQTJELGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUcsT0FBTyxFQUFFLDRCQUE0QixFQUFFLDJCQUEyQixFQUFFLE1BQU0sYUFBYSxDQUFDOzs7Ozs7QUFFeEYseUVBQXlFO0FBQ3pFLG9EQUFvRDtBQUNwRCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsaUJBQW9DLEVBQUUsSUFBa0I7SUFDeEYsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUU7UUFDbkMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDaEM7SUFFRCxPQUFPLEdBQUcsRUFBRSxDQUNWLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7UUFDdEIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNyQixLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDO1FBQ0YsaUJBQWlCLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMxRCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsTUFBa0I7SUFDbEQsT0FBTztRQUNMLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtRQUNoRSxFQUFFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDakUsRUFBRSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxNQUFNLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDckY7WUFDRSxPQUFPLEVBQUUsZUFBZTtZQUN4QixVQUFVLEVBQUUsaUJBQWlCO1lBQzdCLElBQUksRUFBRSxDQUFDLGlCQUFpQixFQUFFLG9CQUFvQixDQUFDO1lBQy9DLEtBQUssRUFBRSxJQUFJO1NBQ1o7S0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxrQkFBa0IsQ0FBQyxNQUFvQjtJQUNyRCxPQUFPO1FBQ0wsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1FBQ2pFLEVBQUUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO0tBQ3RGLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQixDQUFDLE9BQU87SUFDdEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztBQUN4RyxDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0JHO0FBT0gsTUFBTSxPQUFPLGNBQWM7SUFDekI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BbUNHO0lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFxQixFQUFFO1FBQ3BDLE9BQU87WUFDTCxRQUFRLEVBQUUsY0FBYztZQUN4QixTQUFTLEVBQUU7Z0JBQ1QsNEJBQTRCO2dCQUM1QiwyQkFBMkI7Z0JBQzNCLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7Z0JBQ2hDLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDO2FBQzdCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0F1Qkc7SUFDSCxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQXVCLEVBQUU7UUFDdkMsT0FBTztZQUNMLFFBQVEsRUFBRSxjQUFjO1lBQ3hCLFNBQVMsRUFBRSxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7U0FDdEMsQ0FBQztJQUNKLENBQUM7OzJHQTlFVSxjQUFjOzRHQUFkLGNBQWMscUdBTGYsWUFBWTs0R0FLWCxjQUFjLFlBTGhCLENBQUMsWUFBWSxDQUFDOzJGQUtaLGNBQWM7a0JBTjFCLFFBQVE7bUJBQUM7b0JBQ1IsT0FBTyxFQUFFLENBQUMsWUFBWSxDQUFDO29CQUN2QixZQUFZLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDcEMsT0FBTyxFQUFFLENBQUMsb0JBQW9CLENBQUM7b0JBQy9CLGVBQWUsRUFBRSxDQUFDLE1BQU0sQ0FBQztpQkFDMUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVSVJPVVRFUl9NT0RVTEVfVE9LRU4sIFVJUk9VVEVSX1JPT1RfTU9EVUxFIH0gZnJvbSAnLi9pbmplY3Rpb25Ub2tlbnMnO1xuaW1wb3J0IHsgTmcyU3RhdGVEZWNsYXJhdGlvbiB9IGZyb20gJy4vaW50ZXJmYWNlJztcbmltcG9ydCB7XG4gIE5nTW9kdWxlLFxuICBNb2R1bGVXaXRoUHJvdmlkZXJzLFxuICBBTkFMWVpFX0ZPUl9FTlRSWV9DT01QT05FTlRTLFxuICBQcm92aWRlcixcbiAgSW5qZWN0b3IsXG4gIEFQUF9JTklUSUFMSVpFUixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUsIExvY2F0aW9uU3RyYXRlZ3ksIEhhc2hMb2NhdGlvblN0cmF0ZWd5LCBQYXRoTG9jYXRpb25TdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBfVUlST1VURVJfRElSRUNUSVZFUyB9IGZyb20gJy4vZGlyZWN0aXZlcy9kaXJlY3RpdmVzJztcbmltcG9ydCB7IFVJVmlldyB9IGZyb20gJy4vZGlyZWN0aXZlcy91aVZpZXcnO1xuaW1wb3J0IHsgVXJsUnVsZUhhbmRsZXJGbiwgVGFyZ2V0U3RhdGUsIFRhcmdldFN0YXRlRGVmLCBVSVJvdXRlciwgVHJhbnNpdGlvblNlcnZpY2UgfSBmcm9tICdAdWlyb3V0ZXIvY29yZSc7XG5pbXBvcnQgeyBfVUlST1VURVJfSU5TVEFOQ0VfUFJPVklERVJTLCBfVUlST1VURVJfU0VSVklDRV9QUk9WSURFUlMgfSBmcm9tICcuL3Byb3ZpZGVycyc7XG5cbi8vIERlbGF5IGFuZ3VsYXIgYm9vdHN0cmFwIHVudGlsIGZpcnN0IHRyYW5zaXRpb24gaXMgc3VjY2Vzc2Z1bCwgZm9yIFNTUi5cbi8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdWktcm91dGVyL2FuZ3VsYXIvcHVsbC8xMjdcbmV4cG9ydCBmdW5jdGlvbiBvblRyYW5zaXRpb25SZWFkeSh0cmFuc2l0aW9uU2VydmljZTogVHJhbnNpdGlvblNlcnZpY2UsIHJvb3Q6IFJvb3RNb2R1bGVbXSkge1xuICBjb25zdCBtb2QgPSByb290WzBdO1xuICBpZiAoIW1vZCB8fCAhbW9kLmRlZmVySW5pdGlhbFJlbmRlcikge1xuICAgIHJldHVybiAoKSA9PiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIHJldHVybiAoKSA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBjb25zdCBob29rID0gKHRyYW5zKSA9PiB7XG4gICAgICAgIHRyYW5zLnByb21pc2UudGhlbihyZXNvbHZlLCByZXNvbHZlKTtcbiAgICAgIH07XG4gICAgICB0cmFuc2l0aW9uU2VydmljZS5vblN0YXJ0KHt9LCBob29rLCB7IGludm9rZUxpbWl0OiAxIH0pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZVJvb3RQcm92aWRlcnMobW9kdWxlOiBSb290TW9kdWxlKTogUHJvdmlkZXJbXSB7XG4gIHJldHVybiBbXG4gICAgeyBwcm92aWRlOiBVSVJPVVRFUl9ST09UX01PRFVMRSwgdXNlVmFsdWU6IG1vZHVsZSwgbXVsdGk6IHRydWUgfSxcbiAgICB7IHByb3ZpZGU6IFVJUk9VVEVSX01PRFVMRV9UT0tFTiwgdXNlVmFsdWU6IG1vZHVsZSwgbXVsdGk6IHRydWUgfSxcbiAgICB7IHByb3ZpZGU6IEFOQUxZWkVfRk9SX0VOVFJZX0NPTVBPTkVOVFMsIHVzZVZhbHVlOiBtb2R1bGUuc3RhdGVzIHx8IFtdLCBtdWx0aTogdHJ1ZSB9LFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IEFQUF9JTklUSUFMSVpFUixcbiAgICAgIHVzZUZhY3Rvcnk6IG9uVHJhbnNpdGlvblJlYWR5LFxuICAgICAgZGVwczogW1RyYW5zaXRpb25TZXJ2aWNlLCBVSVJPVVRFUl9ST09UX01PRFVMRV0sXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9LFxuICBdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZUNoaWxkUHJvdmlkZXJzKG1vZHVsZTogU3RhdGVzTW9kdWxlKTogUHJvdmlkZXJbXSB7XG4gIHJldHVybiBbXG4gICAgeyBwcm92aWRlOiBVSVJPVVRFUl9NT0RVTEVfVE9LRU4sIHVzZVZhbHVlOiBtb2R1bGUsIG11bHRpOiB0cnVlIH0sXG4gICAgeyBwcm92aWRlOiBBTkFMWVpFX0ZPUl9FTlRSWV9DT01QT05FTlRTLCB1c2VWYWx1ZTogbW9kdWxlLnN0YXRlcyB8fCBbXSwgbXVsdGk6IHRydWUgfSxcbiAgXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvY2F0aW9uU3RyYXRlZ3kodXNlSGFzaCkge1xuICByZXR1cm4geyBwcm92aWRlOiBMb2NhdGlvblN0cmF0ZWd5LCB1c2VDbGFzczogdXNlSGFzaCA/IEhhc2hMb2NhdGlvblN0cmF0ZWd5IDogUGF0aExvY2F0aW9uU3RyYXRlZ3kgfTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIFVJLVJvdXRlciBNb2R1bGVzXG4gKlxuICogVGhpcyBjbGFzcyBoYXMgdHdvIHN0YXRpYyBmYWN0b3J5IG1ldGhvZHMgd2hpY2ggY3JlYXRlIFVJUm91dGVyIE1vZHVsZXMuXG4gKiBBIFVJLVJvdXRlciBNb2R1bGUgaXMgYW4gW0FuZ3VsYXIgTmdNb2R1bGVdKGh0dHBzOi8vYW5ndWxhci5pby9kb2NzL3RzL2xhdGVzdC9ndWlkZS9uZ21vZHVsZS5odG1sKVxuICogd2l0aCBzdXBwb3J0IGZvciBVSS1Sb3V0ZXIuXG4gKlxuICogIyMjIFVJUm91dGVyIERpcmVjdGl2ZXNcbiAqXG4gKiBXaGVuIGEgVUktUm91dGVyIE1vZHVsZSBpcyBpbXBvcnRlZCBpbnRvIGEgYE5nTW9kdWxlYCwgdGhhdCBtb2R1bGUncyBjb21wb25lbnRzXG4gKiBjYW4gdXNlIHRoZSBVSVJvdXRlciBEaXJlY3RpdmVzIHN1Y2ggYXMgW1tVSVZpZXddXSwgW1tVSVNyZWZdXSwgW1tVSVNyZWZBY3RpdmVdXS5cbiAqXG4gKiAjIyMgU3RhdGUgRGVmaW5pdGlvbnNcbiAqXG4gKiBTdGF0ZSBkZWZpbml0aW9ucyBmb3VuZCBpbiB0aGUgYHN0YXRlczpgIHByb3BlcnR5IGFyZSBwcm92aWRlZCB0byB0aGUgRGVwZW5kZW5jeSBJbmplY3Rvci5cbiAqIFRoaXMgZW5hYmxlcyBVSS1Sb3V0ZXIgdG8gYXV0b21hdGljYWxseSByZWdpc3RlciB0aGUgc3RhdGVzIHdpdGggdGhlIFtbU3RhdGVSZWdpc3RyeV1dIGF0IGJvb3RzdHJhcCAoYW5kIGR1cmluZyBsYXp5IGxvYWQpLlxuICpcbiAqICMjIyBFbnRyeSBDb21wb25lbnRzXG4gKlxuICogQW55IHJvdXRlZCBjb21wb25lbnRzIGFyZSBhZGRlZCBhcyBgZW50cnlDb21wb25lbnRzOmAgc28gdGhleSB3aWxsIGdldCBjb21waWxlZC5cbiAqL1xuQE5nTW9kdWxlKHtcbiAgaW1wb3J0czogW0NvbW1vbk1vZHVsZV0sXG4gIGRlY2xhcmF0aW9uczogW19VSVJPVVRFUl9ESVJFQ1RJVkVTXSxcbiAgZXhwb3J0czogW19VSVJPVVRFUl9ESVJFQ1RJVkVTXSxcbiAgZW50cnlDb21wb25lbnRzOiBbVUlWaWV3XSxcbn0pXG5leHBvcnQgY2xhc3MgVUlSb3V0ZXJNb2R1bGUge1xuICAvKipcbiAgICogQ3JlYXRlcyBhIFVJLVJvdXRlciBNb2R1bGUgZm9yIHRoZSByb290IChib290c3RyYXBwZWQpIGFwcGxpY2F0aW9uIG1vZHVsZSB0byBpbXBvcnRcbiAgICpcbiAgICogVGhpcyBmYWN0b3J5IGZ1bmN0aW9uIGNyZWF0ZXMgYW4gW0FuZ3VsYXIgTmdNb2R1bGVdKGh0dHBzOi8vYW5ndWxhci5pby9kb2NzL3RzL2xhdGVzdC9ndWlkZS9uZ21vZHVsZS5odG1sKVxuICAgKiB3aXRoIFVJLVJvdXRlciBzdXBwb3J0LlxuICAgKlxuICAgKiBUaGUgYGZvclJvb3RgIG1vZHVsZSBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGBpbXBvcnRzOmAgb2YgdGhlIGBOZ01vZHVsZWAgYmVpbmcgYm9vdHN0cmFwcGVkLlxuICAgKiBBbiBhcHBsaWNhdGlvbiBzaG91bGQgb25seSBjcmVhdGUgYW5kIGltcG9ydCBhIHNpbmdsZSBgTmdNb2R1bGVgIHVzaW5nIGBmb3JSb290KClgLlxuICAgKiBBbGwgb3RoZXIgbW9kdWxlcyBzaG91bGQgYmUgY3JlYXRlZCB1c2luZyBbW1VJUm91dGVyTW9kdWxlLmZvckNoaWxkXV0uXG4gICAqXG4gICAqIFVubGlrZSBgZm9yQ2hpbGRgLCBhbiBgTmdNb2R1bGVgIHJldHVybmVkIGJ5IHRoaXMgZmFjdG9yeSBwcm92aWRlcyB0aGUgW1tVSVJvdXRlcl1dIHNpbmdsZXRvbiBvYmplY3QuXG4gICAqIFRoaXMgZmFjdG9yeSBhbHNvIGFjY2VwdHMgcm9vdC1sZXZlbCByb3V0ZXIgY29uZmlndXJhdGlvbi5cbiAgICogVGhlc2UgYXJlIHRoZSBvbmx5IGRpZmZlcmVuY2VzIGJldHdlZW4gYGZvclJvb3RgIGFuZCBgZm9yQ2hpbGRgLlxuICAgKlxuICAgKiBFeGFtcGxlOlxuICAgKiBgYGBqc1xuICAgKiBsZXQgcm91dGVyQ29uZmlnID0ge1xuICAgKiAgIG90aGVyd2lzZTogJy9ob21lJyxcbiAgICogICBzdGF0ZXM6IFtob21lU3RhdGUsIGFib3V0U3RhdGVdXG4gICAqIH07XG4gICAqXG4gICAqIEAgTmdNb2R1bGUoe1xuICAgKiAgIGltcG9ydHM6IFtcbiAgICogICAgIEJyb3dzZXJNb2R1bGUsXG4gICAqICAgICBVSVJvdXRlck1vZHVsZS5mb3JSb290KHJvdXRlckNvbmZpZyksXG4gICAqICAgICBGZWF0dXJlTW9kdWxlMVxuICAgKiAgIF1cbiAgICogfSlcbiAgICogY2xhc3MgTXlSb290QXBwTW9kdWxlIHt9XG4gICAqXG4gICAqIGJyb3dzZXJQbGF0Zm9ybUR5bmFtaWMuYm9vdHN0cmFwTW9kdWxlKE15Um9vdEFwcE1vZHVsZSk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gY29uZmlnIGRlY2xhcmF0aXZlIFVJLVJvdXRlciBjb25maWd1cmF0aW9uXG4gICAqIEByZXR1cm5zIGFuIGBOZ01vZHVsZWAgd2hpY2ggcHJvdmlkZXMgdGhlIFtbVUlSb3V0ZXJdXSBzaW5nbGV0b24gaW5zdGFuY2VcbiAgICovXG4gIHN0YXRpYyBmb3JSb290KGNvbmZpZzogUm9vdE1vZHVsZSA9IHt9KTogTW9kdWxlV2l0aFByb3ZpZGVyczxVSVJvdXRlck1vZHVsZT4ge1xuICAgIHJldHVybiB7XG4gICAgICBuZ01vZHVsZTogVUlSb3V0ZXJNb2R1bGUsXG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgX1VJUk9VVEVSX0lOU1RBTkNFX1BST1ZJREVSUyxcbiAgICAgICAgX1VJUk9VVEVSX1NFUlZJQ0VfUFJPVklERVJTLFxuICAgICAgICBsb2NhdGlvblN0cmF0ZWd5KGNvbmZpZy51c2VIYXNoKSxcbiAgICAgICAgLi4ubWFrZVJvb3RQcm92aWRlcnMoY29uZmlnKSxcbiAgICAgIF0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGBOZ01vZHVsZWAgZm9yIGEgVUlSb3V0ZXIgbW9kdWxlXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhbiBbQW5ndWxhciBOZ01vZHVsZV0oaHR0cHM6Ly9hbmd1bGFyLmlvL2RvY3MvdHMvbGF0ZXN0L2d1aWRlL25nbW9kdWxlLmh0bWwpXG4gICAqIHdpdGggVUktUm91dGVyIHN1cHBvcnQuXG4gICAqXG4gICAqICMjIyMgRXhhbXBsZTpcbiAgICogYGBganNcbiAgICogdmFyIGhvbWVTdGF0ZSA9IHsgbmFtZTogJ2hvbWUnLCB1cmw6ICcvaG9tZScsIGNvbXBvbmVudDogSG9tZSB9O1xuICAgKiB2YXIgYWJvdXRTdGF0ZSA9IHsgbmFtZTogJ2Fib3V0JywgdXJsOiAnL2Fib3V0JywgY29tcG9uZW50OiBBYm91dCB9O1xuICAgKlxuICAgKiBAIE5nTW9kdWxlKHtcbiAgICogICBpbXBvcnRzOiBbXG4gICAqICAgICBVSVJvdXRlck1vZHVsZS5mb3JDaGlsZCh7IHN0YXRlczogWyBob21lU3RhdGUsIGFib3V0U3RhdGUgXSB9KSxcbiAgICogICAgIFNoYXJlZE1vZHVsZSxcbiAgICogICBdLFxuICAgKiAgIGRlY2xhcmF0aW9uczogWyBIb21lLCBBYm91dCBdLFxuICAgKiB9KVxuICAgKiBleHBvcnQgY2xhc3MgQXBwTW9kdWxlIHt9O1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIG1vZHVsZSBVSS1Sb3V0ZXIgbW9kdWxlIG9wdGlvbnNcbiAgICogQHJldHVybnMgYW4gYE5nTW9kdWxlYFxuICAgKi9cbiAgc3RhdGljIGZvckNoaWxkKG1vZHVsZTogU3RhdGVzTW9kdWxlID0ge30pOiBNb2R1bGVXaXRoUHJvdmlkZXJzPFVJUm91dGVyTW9kdWxlPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5nTW9kdWxlOiBVSVJvdXRlck1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogbWFrZUNoaWxkUHJvdmlkZXJzKG1vZHVsZSksXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFVJLVJvdXRlciBkZWNsYXJhdGl2ZSBjb25maWd1cmF0aW9uIHdoaWNoIGNhbiBiZSBwcm92aWRlZCB0byBbW1VJUm91dGVyTW9kdWxlLmZvclJvb3RdXVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJvb3RNb2R1bGUgZXh0ZW5kcyBTdGF0ZXNNb2R1bGUge1xuICAvKipcbiAgICogQ2hvb3NlcyBhIGBMb2NhdGlvblN0cmF0ZWd5YC5cbiAgICpcbiAgICogVGhlIGxvY2F0aW9uIHN0cmF0ZWd5IGVuYWJsZXMgZWl0aGVyIEhUTUw1IFB1c2ggU3RhdGVcbiAgICogKFJlcXVpcmVzIHNlcnZlci1zaWRlIHN1cHBvcnQpIG9yIFwiSGFzaEJhbmdcIiBVUkxzLlxuICAgKlxuICAgKiBXaGVuIGBmYWxzZWAsIHVzZXMgW2BQYXRoTG9jYXRpb25TdHJhdGVneWBdKGh0dHBzOi8vYW5ndWxhci5pby9kb2NzL3RzL2xhdGVzdC9hcGkvY29tbW9uL2luZGV4L1BhdGhMb2NhdGlvblN0cmF0ZWd5LWNsYXNzLmh0bWwpXG4gICAqIFdoZW4gYHRydWVgLCB1c2VzIFtgSGFzaExvY2F0aW9uU3RyYXRlZ3lgXShodHRwczovL2FuZ3VsYXIuaW8vZG9jcy90cy9sYXRlc3QvYXBpL2NvbW1vbi9pbmRleC9IYXNoTG9jYXRpb25TdHJhdGVneS1jbGFzcy5odG1sKVxuICAgKlxuICAgKiBEZWZhdWx0cyB0byBgZmFsc2VgXG4gICAqL1xuICB1c2VIYXNoPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQ29uZmlndXJlcyB0aGUgYG90aGVyd2lzZWAgcnVsZSwgd2hpY2ggY2hvb3NlcyB0aGUgc3RhdGUgb3IgVVJMIHRvIGFjdGl2YXRlIHdoZW4gbm8gb3RoZXIgcm91dGVzIG1hdGNoZWQuXG4gICAqXG4gICAqIFNlZTogW1tVcmxSdWxlc0FwaS5vdGhlcndpc2VdXS5cbiAgICovXG4gIG90aGVyd2lzZT86IHN0cmluZyB8IFVybFJ1bGVIYW5kbGVyRm4gfCBUYXJnZXRTdGF0ZSB8IFRhcmdldFN0YXRlRGVmO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmVzIHRoZSBgaW5pdGlhbGAgcnVsZSwgd2hpY2ggY2hvb3NlcyB0aGUgc3RhdGUgb3IgVVJMIHRvIGFjdGl2YXRlIHdoZW4gdGhlXG4gICAqIGFwcGxpY2F0aW9uIGluaXRpYWxseSBzdGFydHMsIGFuZCBubyBvdGhlciByb3V0ZXMgbWF0Y2hlZC5cbiAgICpcbiAgICogU2VlOiBbW1VybFJ1bGVzQXBpLmluaXRpYWxdXS5cbiAgICovXG4gIGluaXRpYWw/OiBzdHJpbmcgfCBVcmxSdWxlSGFuZGxlckZuIHwgVGFyZ2V0U3RhdGUgfCBUYXJnZXRTdGF0ZURlZjtcblxuICAvKipcbiAgICogU2V0cyBbW1VybFJvdXRlclByb3ZpZGVyLmRlZmVySW50ZXJjZXB0XV1cbiAgICovXG4gIGRlZmVySW50ZXJjZXB0PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVGVsbHMgQW5ndWxhciB0byBkZWZlciB0aGUgZmlyc3QgcmVuZGVyIHVudGlsIGFmdGVyIHRoZSBpbml0aWFsIHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAqXG4gICAqIFdoZW4gYHRydWVgLCBhZGRzIGFuIGFzeW5jIGBBUFBfSU5JVElBTElaRVJgIHdoaWNoIGlzIHJlc29sdmVkIGFmdGVyIGFueSBgb25TdWNjZXNzYCBvciBgb25FcnJvcmAuXG4gICAqIFRoZSBpbml0aWFsaXplciBzdG9wcyBhbmd1bGFyIGZyb20gcmVuZGVyaW5nIHRoZSByb290IGNvbXBvbmVudCB1bnRpbCBhZnRlciB0aGUgZmlyc3QgdHJhbnNpdGlvbiBjb21wbGV0ZXMuXG4gICAqIFRoaXMgbWF5IHByZXZlbnQgaW5pdGlhbCBwYWdlIGZsaWNrZXIgd2hpbGUgdGhlIHN0YXRlIGlzIGJlaW5nIGxvYWRlZC5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gYGZhbHNlYFxuICAgKi9cbiAgZGVmZXJJbml0aWFsUmVuZGVyPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBVSS1Sb3V0ZXIgTW9kdWxlIGRlY2xhcmF0aXZlIGNvbmZpZ3VyYXRpb24gd2hpY2ggY2FuIGJlIHBhc3NlZCB0byBbW1VJUm91dGVyTW9kdWxlLmZvckNoaWxkXV1cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdGF0ZXNNb2R1bGUge1xuICAvKipcbiAgICogVGhlIG1vZHVsZSdzIFVJLVJvdXRlciBzdGF0ZXNcbiAgICpcbiAgICogVGhpcyBsaXN0IG9mIFtbTmcyU3RhdGVEZWNsYXJhdGlvbl1dIG9iamVjdHMgd2lsbCBiZSByZWdpc3RlcmVkIHdpdGggdGhlIFtbU3RhdGVSZWdpc3RyeV1dLlxuICAgKiBBbHNvLCB0aGUgY29tcG9uZW50cyB0aGF0IHRoZSBzdGF0ZXMgcm91dGUgdG8gd2lsbCBiZSBhZGRlZCB0byBgZW50cnlDb21wb25lbnRzYCBzbyB0aGV5IHdpbGwgYmUgY29tcGlsZWQuXG4gICAqL1xuICBzdGF0ZXM/OiBOZzJTdGF0ZURlY2xhcmF0aW9uW107XG5cbiAgLyoqXG4gICAqIEEgVUktUm91dGVyIE1vZHVsZSdzIGltcGVyYXRpdmUgY29uZmlndXJhdGlvblxuICAgKlxuICAgKiBJZiBhIFVJLVJvdXRlciBNb2R1bGUgbmVlZHMgdG8gcGVyZm9ybSBzb21lIGNvbmZpZ3VyYXRpb24gKHN1Y2ggYXMgcmVnaXN0ZXJpbmdcbiAgICogcGFyYW1ldGVyIHR5cGVzIG9yIFRyYW5zaXRpb24gSG9va3MpIGEgYGNvbmZpZ0ZuYCBzaG91bGQgYmUgc3VwcGxpZWQuXG4gICAqIFRoZSBmdW5jdGlvbiB3aWxsIGJlIHBhc3NlZCB0aGUgYFVJUm91dGVyYCBpbnN0YW5jZSwgdGhlIG1vZHVsZSdzIGBJbmplY3RvcmAsXG4gICAqIGFuZCB0aGUgbW9kdWxlIG9iamVjdC5cbiAgICpcbiAgICogIyMjIyBFeGFtcGxlOlxuICAgKiBgYGBqc1xuICAgKiBpbXBvcnQgeyBJbmplY3RvciB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG4gICAqIGltcG9ydCB7IFVJUm91dGVyIH0gZnJvbSBcIkB1aXJvdXRlci9hbmd1bGFyXCI7XG4gICAqIGltcG9ydCB7IHJlcXVpcmVBdXRoSG9vayB9IGZyb20gXCIuL3JlcXVpcmVBdXRoSG9va1wiO1xuICAgKiBpbXBvcnQgeyBNeVNlcnZpY2UgfSBmcm9tIFwiLi9teVNlcnZpY2VcIjtcbiAgICpcbiAgICogZXhwb3J0IGZ1bmN0aW9uIGNvbmZpZ3VyZU15TW9kdWxlKHVpUm91dGVyOiBVSVJvdXRlciwgaW5qZWN0b3I6IEluamVjdG9yLCBtb2R1bGU6IFN0YXRlc01vZHVsZSkge1xuICAgKiAgIC8vIEdldCBVSVJvdXRlciBzZXJ2aWNlcyBvZmYgdGhlIFVJUm91dGVyIG9iamVjdFxuICAgKiAgIGxldCB1cmxDb25maWcgPSB1aVJvdXRlci51cmxTZXJ2aWNlLmNvbmZpZztcbiAgICogICBsZXQgdHJhbnNpdGlvblNlcnZpY2UgPSB1aVJvdXRlci50cmFuc2l0aW9uU2VydmljZTtcbiAgICogICB1aVJvdXRlci50cmFjZS5lbmFibGUoXCJUUkFOU0lUSU9OXCIpO1xuICAgKlxuICAgKiAgIHRyYW5zaXRpb25TZXJ2aWNlLm9uQmVmb3JlKHsgdG86IChzdGF0ZSkgPT4gc3RhdGUucmVxdWlyZXNBdXRoIH0sIHJlcXVpcmVBdXRoSG9vayk7XG4gICAqXG4gICAqICAgLy8gQ3JlYXRlIGEgc2x1ZyB0eXBlIGJhc2VkIG9uIHRoZSBzdHJpbmcgdHlwZVxuICAgKiAgIGxldCBidWlsdEluU3RyaW5nVHlwZSA9IHVybENvbmZpZy50eXBlKCdzdHJpbmcnKTtcbiAgICogICBsZXQgc2x1Z1R5cGUgPSBPYmplY3QuYXNzaWduKHt9LCBidWlsdEluU3RyaW5nVHlwZSwgeyBlbmNvZGU6IChzdHIpID0+IHN0ciwgZGVjb2RlOiAoc3RyKSA9PiBzdHIgfSk7XG4gICAqICAgdXJsQ29uZmlnLnR5cGUoJ3NsdWcnLCBzbHVnVHlwZSk7XG4gICAqXG4gICAqICAgLy8gSW5qZWN0IGFyYml0cmFyeSBzZXJ2aWNlcyBmcm9tIERJIHVzaW5nIHRoZSBJbmplY3RvciBhcmd1bWVudFxuICAgKiAgIGxldCBteVNlcnZpY2U6IE15U2VydmljZSA9IGluamVjdG9yLmdldChNeVNlcnZpY2UpXG4gICAqICAgbXlTZXJ2aWNlLnVzZUZhc3RNb2RlKCk7XG4gICAqIH1cbiAgICogYGBgXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIEBOZ01vZHVsZSh7XG4gICAqICAgaW1wb3J0czogW1xuICAgKiAgICAgVUlSb3V0ZXJNb2R1bGUuZm9yQ2hpbGQoeyBzdGF0ZXM6IFNUQVRFUywgY29uZmlnOiBjb25maWd1cmVNeU1vZHVsZSB9KTtcbiAgICogICBdXG4gICAqIH0pXG4gICAqIGNsYXNzIE15TW9kdWxlIHt9XG4gICAqIGBgYFxuICAgKi9cbiAgY29uZmlnPzogKHVpUm91dGVySW5zdGFuY2U6IFVJUm91dGVyLCBpbmplY3RvcjogSW5qZWN0b3IsIG1vZHVsZTogU3RhdGVzTW9kdWxlKSA9PiBhbnk7XG59XG4iXX0=